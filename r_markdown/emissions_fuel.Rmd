---
title: "Fuel burned"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
  library(knitr)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_functions.R")
```

# Load

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  mass_fuel <- readRDS("../r_files/mass_fuel.RDS")
  test_info <- readRDS("../r_files/test_info.RDS")
  times_fuel <- readRDS("../r_files/times_fuel.RDS")
  times_test <- readRDS("../r_files/times_test.RDS")
```

# Merge fuel weights with times

* fuel consumed per rep with rep times

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}

fuel_burnt_reps <- times_fuel %>% 
                   left_join(test_info, by = c("id", "id_test", "date")) %>%
                   left_join(mass_fuel, by = c("id", "id_test", "date", "rep", "type"))
```

* fuel consumed total in a test

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  fuel_burnt_test <- dplyr::group_by(fuel_burnt_reps, id) %>% summarise(
                            fuelmass_total = sum(dm, na.rm = TRUE)) %>%
                     dplyr::mutate(units = "g") %>%
                     dplyr::right_join(test_info, by="id") %>%
                     dplyr::right_join(times_test, by=c("id", "id_test", "date"))
```

# Plot

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width=12, fig.height=8}
  ggplot(filter(fuel_burnt_reps, fuel_type != "blank"), aes(x = rep, y = dm, colour = fuel_type)) +
        geom_point() +
        theme_minimal() + 
        facet_wrap(~ id_test) +
        #theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
        theme(legend.position = "top") +
        ylab("fuel burnt per replicate (g)") +
        xlab("replicate")
```

Notes: 
- consistency in the amount of fuel burnt per replicate and number of replicates across tests of same fuel type. 
- L1 test is a bad test; needs to be censored from data set completely. 


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width=12, fig.height=8}
  ggplot(filter(fuel_burnt_test, fuel_type != "blank"), 
         aes(x = id_test, y = fuelmass_total, colour = as.character(fuel_quant))) +
        geom_point() +
        theme_minimal() + 
        facet_wrap(~ fuel_type, scales = "free") +
        #theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
        theme(legend.position = "top") +
        ylab("fuel burnt total (g)") +
        xlab("id")
```
Notes:
- Major differences in total mass of fuel burnt within the same material type generally correspond with a different number of replicates.
- test N1 was considered potentially problematic due to a line clog issue. Also looks like the mass fuel burnt is very different? 
- test W1 used a different type of wood than other W tests and should be censored. 

# Save

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  saveRDS(fuel_burnt_reps, file = "../r_files/fuel_burnt_reps.RDS")
  saveRDS(fuel_burnt_test, file = "../r_files/fuel_burnt_test.RDS")
```

___

