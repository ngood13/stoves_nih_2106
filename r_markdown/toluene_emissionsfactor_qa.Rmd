---
title: "Toluene Emissions Factor QA/QC"
author: "Kristen Fedak"
date: "January 31, 2017"
output: html_document
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
  library(forcats)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_tidy.R")
```

# Setup

## Load data

**The `emissions.Rda` file contains total emissions for all pollutants.** 

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  load("../r_files/emissions.Rda")  # load pollutant emissions data
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  colnames(emissions)
```

* The column `pol` contains the individual pollutant names. The column `mass_emitted` contains the total mass of each pollutant emitted per firepower sweep test (excluding startup and shutdown periods). Units are $micrograms$ $of$ $total$ $mass$ $emitted$


**The `samples.Rda` file contains metadata related to the test IDs, such as what stove and fuel type was burned.**

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  load("../r_files/samples.Rda")  # load sample meta data
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  colnames(samples)
```

* The columns `stove` and `fuel` contain the exact stove and fuel type (e.g., "Ceramic Charcoal (Artisan), Coconut Charcoal") that corresponds with the number of the `id` (3 replicates per id number, specified by A, B, and C (sometimes a fourth replicate, D, is also included). The columns `stovecat` and `fuelcat` contain broader categories of stoves and fuels (e.g., "improved, charcoal").

**The `fuel_burnt.Rda` file contains data on the total mass of fuel burned during each test.**

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  load("../r_files/fuel_burnt.Rda")  # fuel use meta data
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  colnames(fuel_burnt)
```

* This column `mass_fuel` is needed to create an emissions factor of $mass$ $of$ $emissions$ $per$ $mass$ $of$ $fuel$ $burned$.

## Select pollutant of interest and merge with fuel burnt and metadata 

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  toluene <- dplyr::filter(emissions,  pol == "voc_toluene")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}  
  toluene <- dplyr::left_join(toluene, 
                              dplyr::select(samples, id, fuel, stove, fuelcat, stovecat),
                              by = "id") %>%
             dplyr::left_join(fuel_burnt, by = "id")
```

* The `toluene` dataframe now contains a subset of the emissions data for only the pollutant toluene. A summary of the dataset is below:  

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  summary(toluene)
```

## Calculate Emissions Factor

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  toluene <- dplyr::mutate(toluene, pol_fuel_mass_ratio = mass_emitted * 1e-6 / mass_fuel)  # ug * 1e-6 / g
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  summary(toluene$pol_fuel_mass_ratio)
```

* units: grams of pollutant emitted per gram of fuel burned **NOTE: VERIFY UNITS**

# Plots

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 12}
ggplot(toluene, aes(x= id, pol_fuel_mass_ratio, colour = fuelcat)) +
  geom_point() +
  ggtitle("Toluene EFs by Test ID") +
  xlab("Test ID") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 10}
ggplot(toluene, aes(x= stove, pol_fuel_mass_ratio, colour = fuel)) +
  geom_point() +
  ggtitle("Toluene EFs by Stove") +
  xlab("Stove type") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 10}
ggplot(toluene, aes(x= stove, pol_fuel_mass_ratio, colour = fuel)) +
  geom_point() +
  facet_grid( ~ stovecat, scales = 'free') +
  ggtitle("Toluene EFs by Stove Type") +
  xlab("Stove type") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 10}
ggplot(toluene, aes(x= stove, pol_fuel_mass_ratio, colour = stovecat)) +
  geom_point() +
  facet_grid( ~ fuelcat, scales = 'free') +
  ggtitle("Toluene EFs by Fuel Type and Stove Type") +
  xlab("Stove type") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45,  hjust = 0.9))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 10}
ggplot(toluene, aes(x= id, pol_fuel_mass_ratio, colour = fuel)) +
  geom_point() +
  facet_wrap(fuelcat ~ stovecat) +
  ggtitle("Toluene EFs by Stove and Fuel categories") +
  xlab("Stove type") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 10}
ggplot(filter(toluene, fuelcat == 'wood'), aes(x= id, pol_fuel_mass_ratio, colour = fuel)) +
  geom_point() +
  facet_grid( ~ stove, scales = 'free') +
  ggtitle("Benzene EFs by Stove Type - Wood Stoves Only") +
  xlab("Stove type") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```



```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 10}
ggplot(filter(toluene, fuelcat == 'charcoal'), aes(x= id, pol_fuel_mass_ratio, colour = fuel)) +
  geom_point() +
  facet_grid( ~ stove, scales = 'free') +
  ggtitle("Benzene EFs by Stove Type - Charcoal Stoves Only") +
  xlab("Stove type") +
  ylab("g emitted / g fuel burned") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```


